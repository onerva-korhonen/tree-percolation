#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
A script for writing the empirical vulnerability curve of Betula pendula (from Gonz치lez-Mu침oz et al. 2018, PLOS ONE 13: e0196075)
in a format readable by percolation.read_and_combine_spreading_probability_optimization_data. The data used here
is obtained by averaging the sigmoidal fits to the vulnerability curves from the four populations considered by Gonz치les-Mu침oz et al.

Created on Mon Mar 10 18:35:30 2025

@author: onervak
"""
import params

import pickle
import numpy as np

def PLC(pressure_range, P_50, s):
    """
    A sigma function for creating vulnerability curve.

    Parameters
    ----------
    pressure_range : array-like
        pressure differences, at which vulnerability is considered
    P_50 : float
        pressure at which PLC=0.5
    s : float
        slope of the sigma function

    Returns
    -------
    PLC : np.array
        sigmoidal vulnerability curve

    """
    PLC = 100 / (1 + np.exp((s / 25) * (pressure_range - P_50)))
    return PLC

P_50 = 1.78
s = -248.658338
save_path = params.empirical_vulnerability_save_path

pressure_differences = np.arange(0, 8, 8/100)
PLC = PLC(pressure_differences, P_50, s)

data = {'pressure_differences': pressure_differences * 1E6, 'PLC': PLC}

with open(save_path, 'wb') as f:
    pickle.dump(data, f)


